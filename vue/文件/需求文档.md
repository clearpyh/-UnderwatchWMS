# 产品需求文档（PRD）

## 一、项目背景
- 项目名称：RuoYi-WMS 仓储管理系统
- 行业/场景：制造/零售/电商的仓储作业（入库、出库、移库、盘库、库存看板）
- 当前痛点：
  - 纸面或 Excel 流程割裂，无法实时掌握库存与作业状态
  - 入出库过程缺少统一口径与单据管控，追溯困难
  - 部门间协同缺少数据闭环（仓库、采购、销售）
- 为什么现在必须做这个产品：
  - 业务规模扩大，手工管理已无法支撑准确性与效率
  - 客户交付时效与成本压力增大，需要标准化的作业系统
  - 需要沉淀数据用于管理决策与流程优化
- 成功的业务指标（KPI / OKR）：
  - 入库/出库单据处理时长中位数 ≤ 10 分钟
  - 库存准确率 ≥ 99.5%
  - 作业错误率（错发/漏发/错上架）≤ 0.3%
  - 系统可用性 ≥ 99.9%，关键页面加载 ≤ 2 秒
  - 单据打印覆盖率 ≥ 95%，线上查询替代线下询问率 ≥ 80%

## 二、目标用户
- 用户画像（至少2类）：
  - 仓库操作员：负责新建/处理入库、出库、移库、盘库，注重操作简洁与状态清晰
  - 仓储主管/管理员：配置仓库/商品/企业资料，审核单据与查看统计报表
  - 审计/财务：查询历史记录与导出数据，关注合规与追溯
- 核心使用场景：
  - 到货入库 → 生成入库单 → 审核 → 入库完成 → 打印单据
  - 客户出库 → 生成出库单 → 审核 → 出库完成 → 打印单据
  - 盘库 → 生成盘库单 → 执行盘点 → 记录盈亏 → 打印盘点单
  - 库存查询与历史 → 库存看板与明细 → 库存记录追溯
- 用户最痛的3个问题：
  - 作业过程不透明，待处理工作量不清楚
  - 单据字段口径不统一，导致对账困难
  - 库存与作业数据分散，无法快速追溯

## 三、产品目标
- 业务目标：标准化入出库/移库/盘库流程，形成统一单据与状态闭环；提供看板能力，提升对作业负载与风险的可视化
- 用户目标：操作简洁清晰，流程状态可见，打印模板统一
- 技术目标：前后端模块化、权限可控、日志审计完善；支持高并发列表查询与分页
- 本阶段不做什么（明确边界）：不做质检/上架/波次/拣货等细粒度阶段；不做安全库存阈值预警策略；不做跨仓调拨智能优化

## 四、功能需求（核心）
- 说明方式：模块 → 功能点 → 详细说明 → 业务规则 → 异常情况（附优先级与是否一期完成）

### 4.1 入库管理（P0，一期必须）
- 列表与筛选：按单号/类型/企业/状态筛选与分页
  - 业务规则：orderStatus ∈ {-1,0,1}；-2 表示“全部/不筛选”
  - 异常：返回空时显示“暂无入库单”；网络错误提示重试
- 新增/编辑：字段完整校验，校验失败阻止提交
  - 业务规则：orderNo 唯一；totalQuantity 自动合计；orderStatus 初始为 0
  - 异常：重复单号/必填缺失 → 明确错误提示
- 入库处理（确认入库）：将状态置为 FINISH
  - 业务规则：仅 Pending 可入库；入库后不可编辑
  - 异常：非 Pending 操作 → 提示“已入库或作废，无法修改”
- 打印单据：统一模板渲染（receipt-panel）

### 4.2 出库管理（P0，一期必须）
- 列表与筛选：按单号/类型/企业/状态筛选与分页
  - 业务规则：与入库一致；optType 为出库类型字典
  - 异常：同入库列表
- 新增/编辑：字段校验与合计
  - 业务规则：orderStatus 初始为 0；totalQuantity/totalAmount 展示
  - 异常：同入库
- 出库处理（确认出库）：状态置为 FINISH；完成后不可编辑
  - 业务规则：仅 Pending 可出库；出库后不可编辑
  - 异常：非 Pending 操作 → 禁用或提示
- 打印单据：统一模板渲染（shipment-panel）

### 4.3 盘库管理（P1，一期必须）
- 列表与筛选：展示盘库状态与盈亏数
  - 业务规则：orderStatus ∈ {-1,0,1}
  - 异常：同列表模块
- 新增/删除/打印：盘库流程闭环
  - 业务规则：完成状态不可删除；删除需确认弹窗
  - 异常：完成状态删除 → 阻止并提示

### 4.4 库存管理与历史（P1，一期必须）
- 库存看板（仓库维度）与库存历史查询
  - 业务规则：记录类型 ∈ {入库、出库、移库、盘库}
  - 异常：空数据与网络错误处理

### 4.5 首页看板（P0，一期必须）
- 指标卡片：入库/出库显示 Pending 数，其他显示“今日到货”
  - 业务规则：Pending=0，Finish=1，Invalid=-1；公告展示最新 6 条
  - 异常：接口失败 → 显示为 0 并提示刷新

## 五、关键业务流程
- 入库：到货 → 新增入库单（Pending） → 校验 → 差错? 是→修正 / 否→确认（Finish） → 打印
- 出库：需求 → 新增出库单（Pending） → 校验 → 库存不足? 是→阻止 / 否→确认（Finish） → 打印
- 盘库：计划 → 新增盘库单（Pending） → 执行盘点 → 差异记录盈亏 → 完成（Finish） → 打印
- 关键决策点：Pending→Finish 前的字段与权限校验
- 异常分支：单号重复/字段缺失/库存不足均阻止提交或确认，并给出明确信息

## 六、数据 & 权限设计
- 关键数据表结构（字段级）：
  - BaseOrder：id, orderNo, totalQuantity, totalAmount, orderStatus, remark, createBy, createTime, updateBy, updateTime
  - ReceiptOrder：id, warehouseId, optType, bizOrderNo, merchantId + BaseOrder字段
  - ShipmentOrder：id, warehouseId, optType, bizOrderNo, merchantId + BaseOrder字段
  - Inventory：id, skuId, warehouseId, quantity, remark
  - Warehouse：id, warehouseName, address, remark
  - ItemSku：id, skuName, skuCode, itemId
  - Merchant：id, merchantName, contact, type
- 角色与权限矩阵：
  - 仓库操作员：新增/编辑/确认入出库、盘库；打印；查看库存
  - 管理员：以上 + 基础资料 CRUD；系统配置
  - 审计/财务：只读查询与导出；不可变更状态
  - 接口权限示例：wms:receipt:all, wms:shipment:all, wms:check:all, wms:inventory:all

## 七、非功能性需求
- 性能：列表查询 ≤ 500ms；分页加载 ≤ 800ms；首页看板 ≤ 2s
- 安全：角色权限控制；输入校验；防重提（幂等）
- 并发：订单确认操作串行；列表查询支持 200 并发
- 日志 & 审计：操作日志完整记录（创建/修改/确认/删除/打印）；异常日志归档
- 容错 & 降级：外部依赖失败时回退为只读查询；看板数据失败显示为 0 并提示

## 八、技术实现建议
- 推荐技术栈：前端 Vue3 + Vite + Element Plus；后端 Spring Boot + Sa-Token + MyBatis + RuoYi；数据库 MySQL；部署 JAR + Nginx
- 架构选型原因：RuoYi 生态成熟，权限/字典/分页等通用能力复用；Vue3 组件化与性能优
- 潜在技术风险：状态粒度较粗，未来细化阶段需扩展数据模型与流程控制；库存预警需补齐策略与字段

## 九、埋点 & 数据分析
- 关键指标：单据创建/确认时长、每日作业量、作业错误率、打印覆盖率、看板加载耗时
- 埋点事件设计：入库/出库/盘库的创建事件、确认事件、打印事件；看板加载事件
- 数据如何驱动迭代：通过 Pending 积压量与确认时长识别瓶颈；以错误率与差异记录优化流程与培训

## 十、验收标准
- 功能验收：入出库/盘库流程可创建、编辑、确认、打印；列表筛选与分页准确；看板指标口径一致
- 性能验收：达成性能项阈值
- 安全验收：角色权限、幂等、输入校验、异常处理符合规范

## 需求漏洞与改进建议
- 库存预警逻辑缺失：建议引入安全库存字段（SKU/仓库维度），设置阈值与提醒策略，纳入看板展示
- 过程阶段细化不足：若需“质检/上架/拣货/波次”，应扩展 orderStatus 或引入子流程表，提升过程监控能力
- 报表能力不足：建议补充统计报表（仓库/品类/企业维度），支持导出与权限控制
