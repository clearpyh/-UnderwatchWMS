## 一、功能基本信息
- 功能名称：入库单创建与确认（Warehousing）
- 所属模块：入库管理
- 功能目标：标准化“到货→建单→确认入库”的作业闭环，确保数据可追溯
- 对应业务价值：增效（作业标准化）/ 风控（状态与权限控制）/ 降本（减少错漏导致的返工）/ 体验（打印与查询统一）

## 二、使用对象
- 使用角色：仓库操作员（主操）、仓储主管/管理员（审核与配置）、审计/财务（只读）
- 使用频率：高
- 是否核心功能：是

## 三、功能范围 & 边界
- 本功能必须做：
  - 入库单的新增/编辑/删除/列表筛选与分页
  - 入库确认（Pending→Finish）
  - 打印入库单
- 本功能明确不做：
  - 细分阶段（质检、上架等）的过程控制
  - 外部通知渠道（短信/邮件）
  - 自动补货与智能路由

## 四、功能流程设计
1. 前置条件
   - 已配置仓库、SKU、企业资料
   - 当前用户具有“入库管理”相关权限
2. 正常流程
   - 新增入库单（Pending）→ 校验表单 → 保存
   - 编辑入库单（Pending）→ 更新信息 → 保存
   - 确认入库（Pending→Finish）→ 锁定不可编辑
   - 打印单据 → 归档/流转
3. 关键决策点
   - orderNo 唯一性校验
   - 状态校验：仅 Pending 可确认入库
   - 权限校验：确认动作仅授权用户可执行
4. 异常流程 & 兜底方案
   - 表单缺失/非法：阻止提交，给出明确字段提示
   - 非 Pending 状态尝试确认：阻止操作并提示原因
   - 网络失败：保持原状态，提示重试；记录错误日志

## 五、功能点拆解
| 功能点名称 | 功能说明 | 业务规则 | 校验规则 | 优先级 |
|---|---|---|---|---|
| 入库单新增 | 录入基本信息并保存为 Pending | orderStatus=0；字段完整 | orderNo 唯一；必填项不为空；数量≥0 | P0 |
| 入库单编辑 | 在 Pending 状态更新信息 | 仅 Pending 可编辑 | 同新增校验 | P0 |
| 入库确认 | 将状态置为 Finish，不可再编辑 | Pending→Finish；不可跨越作废 | 当前状态=Pending；权限通过 | P0 |
| 入库单删除 | 删除未完成单据 | Finish/Invalid 不可删除 | 权限校验，确认弹窗 | P1 |
| 入库打印 | 按模板打印内容 | 使用统一模板 | 数据映射完整、格式正确 | P1 |
| 列表筛选分页 | 单号/类型/企业/状态筛选 | orderStatus ∈ {-1,0,1}，-2=全部 | 参数合法、分页有效 | P0 |

## 六、交互 & 状态设计
- 页面 / 接口入口
  - 列表页入口: src/views/wms/order/receipt/index.vue
  - 编辑页入口: src/views/wms/order/receipt/edit.vue
  - 后端接口: ReceiptOrderController（/wms/receiptOrder）
- 状态流转
  - 初始态：Pending（0）
  - 处理中：编辑/保存中
  - 成功：Finish（1）
  - 失败：作废（-1）或校验失败
- 用户可见反馈
  - Toast：保存成功/失败原因
  - 弹窗：删除确认、状态不可编辑提示
  - 文案：空态与筛选结果提示

## 七、数据设计（功能级）
- 核心数据字段
  - BaseOrder: id, orderNo, totalQuantity, totalAmount, orderStatus, remark, createBy, createTime, updateBy, updateTime
  - ReceiptOrder: warehouseId, optType, bizOrderNo, merchantId（继承 BaseOrder）
- 字段来源
  - 用户输入：orderNo, optType, merchantId, warehouseId, remark, details
  - 系统生成：orderStatus 初始=0，createBy/Time, updateBy/Time，totalQuantity/Amount（合计）
- 是否可编辑
  - Pending 可编辑；Finish/Invalid 不可编辑
- 是否需要审计记录
  - 是（创建/编辑/确认/删除）

## 八、权限 & 安全
- 哪些角色可见：仓库操作员、主管/管理员、审计
- 哪些角色可操作：新增/编辑/确认（操作员/主管/管理员）；删除（管理员）
- 风险点 & 防滥用设计：防重复提交（幂等）；限制批量删除；记录关键操作日志

## 九、非功能性约束
- 性能要求：列表查询 ≤ 500ms；保存/确认 ≤ 800ms
- 并发量预估：列表并发 200；确认动作串行化（单订单）
- 失败重试策略：保存/确认失败提示后手动重试；后端记录异常并报警

## 十、验收标准（非常重要）
- 功能验收：可创建/编辑 Pending 入库单；可确认为 Finish；Finish 后不可编辑；列表筛选与分页准确；打印内容完整
- 异常场景验收：重复单号、非法字段阻止提交并提示；非 Pending 状态尝试确认被拒绝并提示
- 边界条件验收：totalQuantity=0 阻止确认入库并提示修正；大数据量列表分页稳定

## 优化建议
- 当前状态维度仅 Pending/Finish，不区分质检、上架等阶段，难以满足细颗粒流程管控。建议后续引入子阶段表或扩展状态枚举，配合流程引擎实现更强过程可视化与权限控制。
